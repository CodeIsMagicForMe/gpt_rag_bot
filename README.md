# GPT RAG Bot — Subscription Logic Module

Этот репозиторий содержит облегчённую реализацию подсистемы подписок, которая может
быть использована вместе с Telegram-ботом. Решение опирается на
чистые Python-модели и простое хранилище в памяти. Такой подход позволяет запускать
юнит-тесты и демонстрационную бизнес-логику даже в окружении без доступа к внешним
пакетам.

## Возможности

- Сущности пользователей, тарифных планов, подписок, платежей, промокодов и рефералов.
- REST-подобные обработчики (`/payments/stars/confirm`, `/trial/start`, `/promocode/apply`, `/subs/status`).
- Логика пробных периодов, автопродлений, grace-периода и расчёта бонусов по реферальной программе.
- Планировщик напоминаний о скором окончании подписки (Telegram API вызывается только при наличии токена).
- Набор юнит-тестов, проверяющих ключевые бизнес-сценарии.

## Запуск

```bash
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt  # пустой файл, внешние зависимости не требуются
pytest
```

## Структура

- `app/models/` — dataclass-модели домена.
- `app/db/session.py` — минималистичное in-memory-хранилище.
- `app/services/subscription_service.py` — бизнес-логика подписок.
- `app/api/routes.py` — простой регистратор обработчиков, который можно обернуть в любой веб-фреймворк.
- `app/jobs/reminders.py` — утилиты для уведомлений о завершении подписки.
- `alembic/` — декларативное описание схемы (для документационных целей).
- `tests/` — юнит-тесты бизнес-логики.

## Ограничения

- Из-за ограничений окружения код не зависит от FastAPI, SQLAlchemy и других внешних библиотек.
- Миграции Alembic представлены в виде статического описания схемы и не предназначены для прямого запуска.
- Для продакшен-сценария потребуется адаптировать слой хранения (например, заменить `InMemorySession` на работу с БД).
